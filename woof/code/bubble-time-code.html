<head>
    <script src="https://cdn.rawgit.com/stevekrouse/WoofJS/1e9b9a5e25ec87307efbe17924a09c4e0865fe6e/woof.js"></script>
    <script>
    setBackdropURL('https://img.clipartfest.com/20a3f7fedd37d6244dad5185ded8e943_playgrounds-backgrounds-and-background-playground-fun-kids-clipart_900-636.jpeg')

// text introduction
var intro = new Text({
  text: () => "It's bubble time!",
  x: 0,
  y: maxY - 100,
  size: 30,
  color: "black"
})

var instrux1
after(2, 'second', () => {
  intro.hide()
  instrux1 = new Text({
    text: () => "Blow bubbles with the 'W' key and pop them with your mouse.",
    x: 0,
    y: maxY - 100,
    size: 30,
    color: "black"
  })
})

var instrux2
after(6, 'second', () => {
  instrux1.hide()
  instrux2 = new Text({
    text: () => "Use the 'A' and 'D' keys to move around.",
    x: 0,
    y: maxY - 100,
    size: 30,
    color: "black"
  })
})

var instrux3
after(9, 'second', () => {
  instrux2.hide()
  instrux3 = new Text({
    text: () => "Catch the candy and put it in the bowl with the down arrow.",
    x: 0,
    y: maxY - 100,
    size: 30,
    color: "black"
  })
})

var instrux4
after(12, 'second', () => {
  instrux3.hide()
  instrux4 = new Text({
    text: () => "Watch out for hot tamales!",
    color: "black",
    x: 0,
    y: maxY - 100,
    size: 30
  })
})


// Player Key
var legend = new Rectangle({
  width: 400,
  height: 250,
  show: false,
  y: maxY,
  x: 0,
  color: "#F57DA5",
  showing: false

})

var legendText1 = new Text({
  color: "white",
  x: legend.x - 180,
  y: maxY - 25,
  text: () => "A => Left",
  textAlign: "left",
  showing: false,
  size: 14
})

var legendText2 = new Text({
  color: "white",
  x: legend.x - 180,
  y: maxY - 45,
  text: () => "D => Right",
  textAlign: "left",
  showing: false,
  size: 14

})
var legendText3 = new Text({
  color: "white",
  x: legend.x - 180,
  y: maxY - 65,
  text: () => "W => Blow Bubbles",
  textAlign: "left",
  showing: false,
  size: 14

})
var legendText4 = new Text({
  color: "white",
  x: legend.x - 180,
  y: maxY - 85,
  text: () => "Mouse Click => Pop Bubbles for Candy (Avoid Tamales!)",
  textAlign: "left",
  showing: false,
  size: 14
})
var legendText5 = new Text({
  color: "white",
  x: legend.x - 180,
  y: maxY - 105,
  text: () => "Down Arrow => Put Candy in Bowl",
  textAlign: "left",
  showing: false,
  size: 14
})
after(15, 'second', () => {
  instrux4.hide()
  legend.show()
  legendText1.show()
  legendText2.show()
  legendText3.show()
  legendText4.show()
  legendText5.show()
  candycountText.show()
  candycountCircle.show()
})

// Blow bubbles
var blower = new Image({
  url: 'http://content.mycutegraphics.com/graphics/fun/blue-bubble-wand-angled.png',
  width: 100,
  height: 100,
  x: minX + 100,
  y: legend.y - 200
})

var hand = new Image({
  url: 'http://www.iconsdb.com/icons/preview/orange/finger-and-thumb-xxl.png',
  width: 25,
  height: 25
})

forever(() => {
  hand.x = mouseX
  hand.y = mouseY
})

var bubbles = []
every(0.1, 'second', () => {
  if (keysDown.includes('W')) {
    var bubble = new Image({
      url: 'https://img.clipartfest.com/dea2bf71ebd834248e611186e122dd5b_-bubble-shiny-free-image-water-bubbles-shiny-clipart_640-627.png',
      width: random(50, 200),
      height: random(50, 200),
      x: blower.x + 60,
      y: blower.y + 60,
      angle: random(300, 360)
    })
    bubbles.push(bubble)
  }
})

var glass = new Audio('https://www.freespecialeffects.co.uk/soundfx/glass/breaking_glass_01.wav')

var tamales = []
var candies = []

forever(() => {
  bubbles.forEach(bubble => {
    var randomInt = random(1, 2)
    bubble.move(5)
    if (bubble.mouseOver && mouseDown) {
      bubble.delete()
      glass.play()
      if (randomInt === 1) {
        var candy = new Image({
          url: 'https://img.clipartfest.com/eb8743b6a3efad66bac93bb9b1b7eb6e_pink-hard-candy-cute-bubble-gum-wrapper-clipart_300-189.png',
          width: 50,
          height: 25,
          x: bubble.x,
          y: bubble.y
        })
        candies.push(candy)
      }
      if (randomInt === 2) {
        var tamale = new Image({
          url: 'http://economycan-economycandy.netdna-ssl.com/wp-content/uploads/2010/11/Hot-Tamale.png',
          width: 25,
          height: 25,
          x: bubble.x,
          y: bubble.y
        })
        tamales.push(tamale)
      }
    }
  })
})

forever(() => {
  candies.forEach(candy => {
    candy.y -= 3
  })
  tamales.forEach(candy => {
    candy.y -= 3
  })
})

var girl = new Image({
  url: 'http://vignette4.wikia.nocookie.net/gravityfalls/images/4/41/Candy_appearance.png/revision/latest?cb=20141119020338',
  width: 100,
  height: 100,
  y: minY + 100
})

forever(() => {
  if (girl.x > maxX) {
    girl.x = maxX
  }
    if (girl.x < minX) {
    girl.x = minX
  }
})

var bowl = new Image({
  url: 'https://img.clipartfest.com/33aef436575c276eb05a2a8d32c1c116_candy-box-candy-clipart_516-513.gif',
  width: 60,
  height: 60,
  x: maxX - 150,
  y: minY + 60
})

girl.setRotationStyle("ROTATE LEFT RIGHT")

var bowlcandies = []
forever(() => {
  if (keysDown.includes('D') && girl.touching(newBubble) === false) {
    girl.angle = 0
    girl.x += 10
  }
  if (keysDown.includes('A') && girl.touching(newBubble) === false) {
    girl.angle =  180
    girl.x -= 10
  }
  candies.forEach(candy => {
    if (candy.touching(girl)) {
      candy.x = girl.x
      candy.y = girl.y
      candy.pointTowards(girl)
      if (keysDown.includes('DOWN') && girl.distanceTo(bowl) < 150) {
        candy.x = maxX - 50
        candy.y = minY + 50
        candy.delete()
        score++
        var candyinbowl = new Image({
          url: 'https://img.clipartfest.com/eb8743b6a3efad66bac93bb9b1b7eb6e_pink-hard-candy-cute-bubble-gum-wrapper-clipart_300-189.png',
          width: 25,
          height: 25,
          x: bowl.x,
          y: bowl.y + score * 5
        })
        bowlcandies.push(candyinbowl)
      }
    }
  })
})

forever(() => {
  tamales.forEach(candy => {
    if (candy.touching(girl)) {
      candy.delete()
      score = 0
      bowl.setImageURL('http://www.clipartbest.com/cliparts/pT5/o9K/pT5o9Kd6c.gif')
      after(0.2, 'second', () => {
        bowl.setImageURL('https://img.clipartfest.com/33aef436575c276eb05a2a8d32c1c116_candy-box-candy-clipart_516-513.gif')
      })
      bowlcandies.forEach(candy => {
        candy.delete()
      })
      candies.forEach(candy => {
        candy.delete()
      })
    }
  })
})

var score = 0

var candycountCircle = new Circle({
  color: "yellow",
  radius: 70,
  x: maxX - 100,
  y: maxY - 100,
  showing: false
})

var candycountText = new Text({
  text: () => "Candy Count: " + score,
  color: "black",
  size: 16,
  x: candycountCircle.x,
  y: candycountCircle.y,
  showing: false
})

var newBubble = new Image({
  url: 'https://img.clipartfest.com/dea2bf71ebd834248e611186e122dd5b_-bubble-shiny-free-image-water-bubbles-shiny-clipart_640-627.png',
  width: 120,
  height: 120
})
newBubble.hide()


forever(() => {
  if (score > 10) {
    candies.forEach(candy => {
      candy.delete()
    })
    tamales.forEach(candy => {
      candy.delete()
    })
    newBubble.x = girl.x
    newBubble.y = girl.y
    newBubble.show()
    girl.y += 5
    new Text({
      text: () => "YOU WIN!!!",
      color: "#F57DA5",
      size: 80,
      y: maxY - 100,
    })
    candycountText.hide()
    candycountCircle.hide()
    legend.hide()
    legendText1.hide()
    legendText1.hide()
    legendText2.hide()
    legendText3.hide()
    legendText4.hide()
    legendText5.hide()
    if (girl.y > maxY + 100) {
      freeze()
    }
  }
})   
    </script>
</head>
<body>
    
</body>